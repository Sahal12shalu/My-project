<style>
    @media (min-width: 1025px) {
}

.card-registration .select-input.form-control[readonly]:not([disabled]) {
font-size: 1rem;
line-height: 2.15;
padding-left: .75em;
padding-right: .75em;
}

.card-registration .select-arrow {
top: 13px;
}
.totalitem{
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
input[type=text] {
  border-radius: 10px;
  border: 1px solid #2d9fd9;
  width: 270px;
  height: 40px;
  padding-left: 10px;
}

input[type=text]:focus {
  outline: none;
  border: 1px solid #a0d18c;
  
}

#addressinput[type=text]{
  border-radius: 10px;
  border: 1px solid #2d9fd9;
  width: 350px;
  height: 80px;
  padding-left: 10px;
}

#addressinput[type=text]:focus {
  outline: none;
  border: 1px solid #a0d18c;
  
}

.popup-container {
    display: none;
    position: fixed;
    left: 0;
    bottom: 0;
    width: 100%;
    height: 60%;
    background-color: rgba(104, 103, 103, 0.66);
    justify-content: center;
    align-items: center;
}

.popup-content {
    background: rgb(255, 255, 255);
    width: fit-content;
    padding: 20px;
    text-align: center;
    position: relative;
    border-radius: 10px;
    justify-items: center;
    align-items: center;
}

.close-btn {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 20px;
    cursor: pointer;
}
.locationAdd{
  width: 160px;
  height: 40px;
  background-color: #a0d18c;
  color: rgb(255, 255, 255);
  border: solid 2px;
  border-radius: 7px;
}
.popups-container {
    display: none;
    position: fixed;
    left: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    background-color: rgb(255, 255, 255);
    justify-content: center;
    align-items: center;
}

.popups-content {
    background: rgb(255, 255, 255);
    width: fit-content;
    padding: 20px;
    text-align: center;
    position: relative;
    border-radius: 10px;
    justify-items: center;
    align-items: center;
}

</style>

<section class="h-100 h-custom">
  <div class="container py-3 h-100 mt-5" style="margin-bottom: 50px; background: linear-gradient(135deg, #c0c0c191, rgba(214, 254, 255, 0.748) 100%);">
    <div class="row d-flex justify-content-center align-items-center h-100">
      <div class="col-12">
        <div class="cardw card-registration card-registration-2" style="border-radius: 15px;">
          <div class="card-body p-0">
            <div class="row g-0">
              <div class="col-lg-8">
                <div class="p-3">
                  <div class="d-flex justify-content-between align-items-center mb-5">
                    <h1 class="fw-bold mb-0">CartPage</h1>
                    <h6 class="mb-0 text-muted totalitem">{{total}} items</h6>
                  </div>
                  <div class="row mb-4 d-flex justify-content-between align-items-center">
                    {{#each carthoteldetail}}
                    <div class="col-md-5">
                      <img
                        src="/images/hotelpicture/{{this._id}}.jpg"
                        class="img-fluid rounded-3 col-12" alt="Cotton T-shirt" style="height: 300px;">
                    </div>
                    <div class="pt-3 col-md-7">
                      <h2 class="text-muted"><strong>{{this.hotelname}}</strong></h2>
                      <h6 class="mb-0">{{this.description}}</h6>
                    </div>
                    {{/each}}
                  </div>
                  {{#each response}}
                  <hr class="my-4">
                  <div class="row mb-4 d-flex justify-content-between align-items-center">
                    <div class="col-md-1 col-lg-1 col-xl-1 col-2">
                      {{#if (eq this.product.vegornon "veg")}}
                <div class="seconddivofnameandicon"><img class="img-fluid" src="/images/veg-nonveg/veg.png" style="height: 30px; width: 30px;">
                </div>
                {{else}}
                <div class="seconddivofnameandicon"><img class="img-fluid" src="/images/veg-nonveg/nonveg.png" style="height: 30px; width: 30px;">
                </div>
                {{/if}}
                    </div>
                    <div class="col-md-3 col-lg-3 col-xl-3 col-3">
                      <p><strong>{{this.product.productname}}</strong></p>
                    </div>
                    <div class="col-md-3 col-lg-3 col-xl-2 col-4 d-flex">
                      <button class="btn btn-link px-2"
                        onclick="changequantity('{{this._id}}','{{this.product._id}}','{{../user._id}}',-1,-{{this.product.prize}})">
                        <i class="fa fa-minus"></i>
                      </button>
                       
                      <p id="{{this.product._id}}" class="form-control form-control-sm mt-3">{{this.quantity}}</p>

                      <button class="btn btn-link px-2"
                        onclick="changequantity('{{this._id}}','{{this.product._id}}','{{../user._id}}',1,{{this.product.prize}})">
                        <i class="fa fa-plus"></i>
                      </button>
                    </div>
                    <div class="col-md-3 col-lg-2 col-xl-3 col-2 offset-lg-1">€ 
                      <span style="font-family: Arial, Helvetica, sans-serif;" id="s{{this.product._id}}" class="mb-0">{{this.product.totalprize}}</span>
                    </div>
                    <div class="col-md-1 col-lg-1 col-xl-1 col-1 text-end">
                      <a onclick="deletecart('{{this.product._id}}','{{this._id}}')" class="btn text-muted"><i class="fa fa-times"></i></a>
                    </div>
                  </div>
                  {{/each}}

                  <hr class="my-4">

                  <div class="pt-5">
                    <h6 class="mb-0"><a href="/homepage" class="text-body"><i
                          class="fas fa-long-arrow-alt-left me-2"></i>Back to shop</a></h6>
                  </div>
                </div>
              </div>
              <div class="col-lg-4 bg-body-tertiary">
                <div class="ps-5">
                  <h3 class="fw-bold mt-2">Summary</h3>
                  <hr class="my-3">

                  <div class="d-flex justify-content-between mb-2">
                    <p style="font-family: 'Times New Roman', Times, serif;">items : {{total}}</p>
                  </div>
                  <h5 class="text-uppercase mt-2 mb-3">Give code</h5>

                  <div class="mb-3">
                    <div class="form-outline">
                      <input type="text" placeholder="enter your coupon code.." id="form3Examplea2" class="form-control" />
                    </div>
                  </div>
                  <h5 class="text-uppercase mb-3"><strong><u>Your Address</u></strong></h5>
                    {{#if address}}
                    <div class="card col-11">
                      <div class="d-flex justify-content-between">
                      <p id="addressid" hidden>{{address._id}}</p>
                      <p style=" padding-top: 10px; padding-left: 10px;" id="city">{{address.city}}</p>
                      <a onclick="openPopups()" class="changebtn btn btn-secondary mt-3">Change</a>
                      </div>
                      <div style="justify-items: start; padding-left: 10px;">
                      <p id="address">{{address.address}}</p>
                      </div>
                    </div>
                    {{else}}
                    <div class="card col-11"  style="text-align: center; justify-items: center;">
                      <p >Add Address</p>
                    </div>
                    {{/if}}

                  <a onclick="openPopup()" id="locationAdd" class="btn locationAdd mt-3">Add New Location</a>

                  <hr class="my-4">
                  <div class="d-flex justify-content-between " style="padding-right: 10px;">
                    <p >Delivery charge</p>
                    <h5 style="font-family: 'Times New Roman', Times, serif;">€ 24.00</h5>
                  </div>
                  <div class="d-flex justify-content-between mb-3" style="padding-right: 10px;">
                    <p >Product Prize</p>
                    <div><h5 style="font-family: 'Times New Roman', Times, serif;">€ <span id="total">{{totalamount}}</span></h5></div>
                  </div>
                  <div class="d-flex justify-content-between mb-3" style="padding-right: 10px;">
                    <h5 class="text-uppercase">Total price</h5>
                    <h5 style="font-family: 'Times New Roman', Times, serif;">€<span id="grandtotal"> {{grandtotal}}</span></h5>
                  </div>
                  {{#if address}}
                   <a onclick="sendparam()" style="width: 90%;" data-id="addresss" class="mb-3 btn btn-secondary btn-block btn-lg" data-mdb-ripple-color="dark">Checkout</a>
                  {{else}}
                  <a onclick="alert('Please add address')" style="width: 90%;" class="mb-3 btn btn-secondary btn-block btn-lg" data-mdb-ripple-color="dark">Checkout</a>
                  {{/if}}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="popup" class="popup-container">
        <div class="popup-content">
            <span class="close-btn" onclick="closePopup()">&times;</span>
            <h2 >Select your location</h2>
              <div>
                <div>
                  <label class="col-12">Enter your city</label>
                  <input type="text" name="city" placeholder="enter your city" required>
                </div>
                <div>
                  <label class="col-12">Moredetails&phnumber</label>
              <input style="height: 80px;" name="address" type="text" placeholder="add address" required>
                </div>
              </div>
              <div>
                <a onclick="openPopups()" style="width: 220px;" class="btn btn-secondary mt-3 ">Add from address book</a>
              </div>
              <button onclick="submitaddress()" style="width: 220px;" class="locationAdd ">Submit</button>
        </div>
    </div>

    <div id="popups" class="popups-container">
        <div class="popups-content">
            <span class="close-btn" onclick="closePopups()">&times;</span>
            <h2><strong>Choose Address</strong></h2>
            <p>your previous saved address</p>
            {{#each addresses}}
              <div onclick="selectedaddress('{{this.city}}','{{this.address}}','{{this._id}}')" class="card">
                <div>
                  <a onclick="deleteaddress('{{this._id}}')" class="btn close-btn"><strong>&times;</strong></a>
                <h4>{{this.city}}</h4>
                <p>{{this.address}}</p>
                </div>
              </div>
              {{/each}}
              <div>
    </div>
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
 
</section>

<script>
  function changequantity(cartId,proId,userId,count,prize){
    let quantity=parseInt(document.getElementById(proId).innerHTML)
    count=parseInt(count)
    $.ajax({
      url:'/change-product-quantity',
      data:{
        user:userId,
        cart:cartId,
        product:proId,
        count:count,
        quantity:quantity,
        prize:prize
      },
      method:'post',
      success:function(response){
        if(response.heyy){
          alert("product removed from cart")
          location.reload()
      }else{
        
      document.getElementById(proId).innerHTML=quantity+count;
      document.getElementById('total').innerHTML=response.totalamount;
      document.getElementById(`s${proId}`).innerHTML=response.getproducttotal;
      document.getElementById('grandtotal').innerHTML=response.grandtotal;
      }
      }
    })
  }
  
</script>

<script>
  function deletecart(proid,cartId){
    $.ajax({
      url:'/deletecartproduct',
      data:{
        proId:proid,
        cartId:cartId
      },
      method:'post',
      success:function(total){
        if(total === 0){
          alert('are you sure delete the product')
          location.reload()
      }else{
          location.reload()
      }
      }
    })
  }
</script>

<script>
    function openPopup() {
    document.getElementById("popup").style.display = "flex";
}
function closePopup() {
    document.getElementById("popup").style.display = "none";
}
</script>

<script>
  function submitaddress(){
    let city = $('input[name="city"]').val()
    let address = $('input[name="address"]').val()
    $.ajax({
      url:'/addresssubmit',
      data:{
        city:city,
        address:address
      },
      method:'post',
      success:function(response){
        if(response.status){
         
          location.href="/cartpage"
        }
      }
    })
  }
</script>

<script>
    function openPopups() {
    document.getElementById("popups").style.display = "flex";
}
function closePopups() {
    document.getElementById("popups").style.display = "none";
}
</script>

<script>
  function selectedaddress(city,address,id){
    document.getElementById("addressid").innerHTML = id;
    document.getElementById("city").innerHTML = city;
    document.getElementById("address").innerHTML = address;

    document.getElementById("popups").style.display = "none";
    document.getElementById("popup").style.display = "none";
  }
</script>
<script>
  function deleteaddress(proId){
    $.ajax({
      url:'/deleteaddress',
      data:{
        proId:proId
      },
      method:'post',
      success:function(response){
        if(response.status){
          location.reload()
        }else{
          location.reload()
        }
      }
    })
  } 
</script>

<script>
  function sendparam(){
    const id = document.getElementById("addressid").textContent;
    location.href=`/checkout/${id}`
  }
</script>

<script>
  
    $('#locationAdd').mouseenter(function(){
      $('#locationAdd').css({"background-color":"#a0d18c"})
    }),
     $('#locationAdd').mouseleave(function(){
      $('#locationAdd').css({"background-color":"#a0d18c"})
    })
  
</script>
